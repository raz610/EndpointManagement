# --- CUSTOM TEMPLATE START ---
$List = @(
    # Intune Core
    @{ S = "Intune Core"; ID = "163"; H = "manage.microsoft.com" },
    @{ S = "Intune Core"; ID = "163"; H = "EnterpriseEnrollment.manage.microsoft.com" },
    @{ S = "Intune Core"; ID = "163"; H = "104.46.162.97" },
    @{ S = "Intune Core"; ID = "163"; H = "13.67.13.177" },
    @{ S = "Intune Core"; ID = "163"; H = "13.67.15.129" },
    @{ S = "Intune Core"; ID = "163"; H = "13.69.231.129" },
    @{ S = "Intune Core"; ID = "163"; H = "13.69.67.225" },
    @{ S = "Intune Core"; ID = "163"; H = "13.70.78.129" },
    @{ S = "Intune Core"; ID = "163"; H = "13.70.79.129" },
    @{ S = "Intune Core"; ID = "163"; H = "13.74.111.193" },
    @{ S = "Intune Core"; ID = "163"; H = "13.77.53.177" },
    @{ S = "Intune Core"; ID = "163"; H = "13.86.221.177" },
    @{ S = "Intune Core"; ID = "163"; H = "13.89.174.241" },
    @{ S = "Intune Core"; ID = "163"; H = "13.89.175.193" },
    @{ S = "Intune Core"; ID = "163"; H = "20.189.229.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.191.167.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.37.153.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.37.192.129" },
    @{ S = "Intune Core"; ID = "163"; H = "20.38.81.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.41.1.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.42.1.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.42.130.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.42.224.129" },
    @{ S = "Intune Core"; ID = "163"; H = "20.43.129.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.44.19.225" },
    @{ S = "Intune Core"; ID = "163"; H = "40.119.8.129" },
    @{ S = "Intune Core"; ID = "163"; H = "40.67.121.225" },
    @{ S = "Intune Core"; ID = "163"; H = "40.70.151.33" },
    @{ S = "Intune Core"; ID = "163"; H = "40.71.14.97" },
    @{ S = "Intune Core"; ID = "163"; H = "40.74.25.1" },
    @{ S = "Intune Core"; ID = "163"; H = "40.78.245.241" },
    @{ S = "Intune Core"; ID = "163"; H = "40.78.247.129" },
    @{ S = "Intune Core"; ID = "163"; H = "40.79.197.65" },
    @{ S = "Intune Core"; ID = "163"; H = "40.79.197.97" },
    @{ S = "Intune Core"; ID = "163"; H = "40.80.180.209" },
    @{ S = "Intune Core"; ID = "163"; H = "40.80.180.225" },
    @{ S = "Intune Core"; ID = "163"; H = "40.80.184.129" },
    @{ S = "Intune Core"; ID = "163"; H = "40.82.248.225" },
    @{ S = "Intune Core"; ID = "163"; H = "40.82.249.129" },
    @{ S = "Intune Core"; ID = "163"; H = "52.150.137.1" },
    @{ S = "Intune Core"; ID = "163"; H = "52.162.111.97" },
    @{ S = "Intune Core"; ID = "163"; H = "52.168.116.129" },
    @{ S = "Intune Core"; ID = "163"; H = "52.182.141.193" },
    @{ S = "Intune Core"; ID = "163"; H = "52.236.189.97" },
    @{ S = "Intune Core"; ID = "163"; H = "52.240.244.161" },
    @{ S = "Intune Core"; ID = "163"; H = "20.204.193.13" },
    @{ S = "Intune Core"; ID = "163"; H = "20.204.193.11" },
    @{ S = "Intune Core"; ID = "163"; H = "20.192.174.217" },
    @{ S = "Intune Core"; ID = "163"; H = "20.192.159.41" },
    @{ S = "Intune Core"; ID = "163"; H = "104.208.197.65" },
    @{ S = "Intune Core"; ID = "163"; H = "172.160.217.161" },
    @{ S = "Intune Core"; ID = "163"; H = "172.201.237.161" },
    @{ S = "Intune Core"; ID = "163"; H = "172.202.86.193" },
    @{ S = "Intune Core"; ID = "163"; H = "172.205.63.1" },
    @{ S = "Intune Core"; ID = "163"; H = "172.212.214.1" },
    @{ S = "Intune Core"; ID = "163"; H = "172.215.131.1" },
    @{ S = "Intune Core"; ID = "163"; H = "20.168.189.129" },
    @{ S = "Intune Core"; ID = "163"; H = "20.199.207.193" },
    @{ S = "Intune Core"; ID = "163"; H = "20.204.194.129" },
    @{ S = "Intune Core"; ID = "163"; H = "20.208.149.193" },
    @{ S = "Intune Core"; ID = "163"; H = "20.208.157.129" },
    @{ S = "Intune Core"; ID = "163"; H = "20.214.131.177" },
    @{ S = "Intune Core"; ID = "163"; H = "20.91.147.73" },
    @{ S = "Intune Core"; ID = "163"; H = "4.145.74.225" },
    @{ S = "Intune Core"; ID = "163"; H = "4.150.254.65" },
    @{ S = "Intune Core"; ID = "163"; H = "4.154.145.225" },
    @{ S = "Intune Core"; ID = "163"; H = "4.200.254.33" },
    @{ S = "Intune Core"; ID = "163"; H = "4.207.244.1" },
    @{ S = "Intune Core"; ID = "163"; H = "4.213.25.65" },
    @{ S = "Intune Core"; ID = "163"; H = "4.213.86.129" },
    @{ S = "Intune Core"; ID = "163"; H = "4.216.205.33" },
    @{ S = "Intune Core"; ID = "163"; H = "4.237.143.129" },
    @{ S = "Intune Core"; ID = "163"; H = "40.84.70.129" },
    @{ S = "Intune Core"; ID = "163"; H = "48.218.252.129" },
    @{ S = "Intune Core"; ID = "163"; H = "57.151.0.193" },
    @{ S = "Intune Core"; ID = "163"; H = "57.153.235.1" },
    @{ S = "Intune Core"; ID = "163"; H = "57.154.140.129" },
    @{ S = "Intune Core"; ID = "163"; H = "57.154.195.1" },
    @{ S = "Intune Core"; ID = "163"; H = "57.155.45.129" },
    @{ S = "Intune Core"; ID = "163"; H = "68.218.134.97" },
    @{ S = "Intune Core"; ID = "163"; H = "74.224.214.65" },
    @{ S = "Intune Core"; ID = "163"; H = "74.242.35.1" },
    @{ S = "Intune Core"; ID = "163"; H = "172.208.170.1" },
    @{ S = "Intune Core"; ID = "163"; H = "74.241.231.1" },
    @{ S = "Intune Core"; ID = "163"; H = "74.242.184.129" },
    # Front Door
    @{ S = "Intune Core"; ID = "163"; H = "13.107.219.1" },
    @{ S = "Intune Core"; ID = "163"; H = "13.107.227.1" },
    @{ S = "Intune Core"; ID = "163"; H = "13.107.228.1" },
    @{ S = "Intune Core"; ID = "163"; H = "150.171.97.1" },
    @{ S = "Intune Core"; ID = "163"; H = "2620:1ec:40::1" },
    @{ S = "Intune Core"; ID = "163"; H = "2620:1ec:49::1" },
    @{ S = "Intune Core"; ID = "163"; H = "2620:1ec:4a::1" },
    # MDM Delivery Optimization
    @{ S = "Delivery Optimization"; ID = "172"; H = "do.dsp.mp.microsoft.com" },
    @{ S = "Delivery Optimization"; ID = "172"; H = "dl.delivery.mp.microsoft.com" },
    # MEM Win32Apps
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swda01-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swda02-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdb01-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdb02-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdc01-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdc02-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdd01-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdd02-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdin01-mscdn.manage.microsoft.com" },
    @{ S = "MEM Win32Apps"; ID = "170"; H = "swdin02-mscdn.manage.microsoft.com" },
    # Auth
    @{ S = "Device authentication"; ID = "97"; H = "account.live.com" },
    @{ S = "Device authentication"; ID = "97"; H = "login.live.com" },
    # Endpoint Discovery
    @{ S = "Endpoint Discovery"; ID = "190"; H = "go.microsoft.com" },
    # Dependency
    @{ S = "Feature Deployment"; ID = "189"; H = "config.edge.skype.com" },
    @{ S = "Feature Deployment"; ID = "189"; H = "ecs.office.com" },
    # Organizational messages
    @{ S = "Organizational messages"; ID = "192"; H = "fd.api.orgmsg.microsoft.com" },
    @{ S = "Organizational messages"; ID = "192"; H = "ris.prod.api.personalization.ideas.microsoft.com" },
    # Authentication dependencies
    @{ S = "Authentication and Identity"; ID = "56"; H = "login.microsoftonline.com" },
    @{ S = "Authentication and Identity"; ID = "56"; H = "graph.windows.net" },
    # Office Customization Service
    @{ S = "Office Customization Service"; ID = "150"; H = "officeconfig.msocdn.com" },
    @{ S = "Office Customization Service"; ID = "150"; H = "config.office.com" },
    # Identity supporting services & CDNs
    @{ S = "Identity supporting services & CDNs"; ID = "59"; H = "enterpriseregistration.windows.net" },
    @{ S = "Identity supporting services & CDNs"; ID = "59"; H = "certauth.enterpriseregistration.windows.net" },
    # Windows Push Notifications (WNS)
    @{ S = "MEM - WNS"; ID = "171"; H = "notify.windows.com" },
    @{ S = "MEM - WNS"; ID = "171"; H = "wns.windows.com" },
    @{ S = "MEM - WNS"; ID = "171"; H = "sinwns1011421.wns.windows.com" },
    @{ S = "MEM - WNS"; ID = "171"; H = "sin.notify.windows.com" },
    # Remote Help
    @{ S = "Remote Help"; ID = "181"; H = "support.services.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "remoteassistance.support.services.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "teams.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "remoteassistanceprodacs.communication.azure.com" },
    @{ S = "Remote Help"; ID = "181"; H = "edge.skype.com" },
    @{ S = "Remote Help"; ID = "181"; H = "aadcdn.msftauth.net" },
    @{ S = "Remote Help"; ID = "181"; H = "aadcdn.msauth.net" },
    @{ S = "Remote Help"; ID = "181"; H = "alcdn.msauth.net" },
    @{ S = "Remote Help"; ID = "181"; H = "wcpstatic.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "aria.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "browser.pipe.aria.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "events.data.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "v10c.events.data.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "monitor.azure.com" },
    @{ S = "Remote Help"; ID = "181"; H = "js.monitor.azure.com" },
    @{ S = "Remote Help"; ID = "181"; H = "edge.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "trouter.communication.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "trouter.teams.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "api.flightproxy.skype.com" },
    @{ S = "Remote Help"; ID = "181"; H = "ecs.communication.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "remotehelp.microsoft.com" },
    @{ S = "Remote Help"; ID = "181"; H = "remoteassistanceprodacseu.communication.azure.com" },
    @{ S = "Remote Help Chat"; ID = "187"; H = "webpubsub.azure.com" },
    @{ S = "Remote Help Chat"; ID = "187"; H = "AMSUA0101-RemoteAssistService-pubsub.webpubsub.azure.com" },
    # Autopilot
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "windowsupdate.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "dl.delivery.mp.microsoft.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "prod.do.dsp.mp.microsoft.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "delivery.mp.microsoft.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "update.microsoft.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "tsfe.trafficshaping.dsp.mp.microsoft.com" },
    @{ S = "Windows Autopilot - Windows Update"; ID = "164"; H = "adl.windows.com" },
    @{ S = "Windows Autopilot - NTP Sync"; ID = "165"; H = "time.windows.com" },
    @{ S = "Windows Autopilot - WNS Dependencies"; ID = "169"; H = "clientconfig.passport.net" },
    @{ S = "Windows Autopilot - WNS Dependencies"; ID = "169"; H = "windowsphone.com" },
    @{ S = "Windows Autopilot - WNS Dependencies"; ID = "169"; H = "s-microsoft.com" },
    @{ S = "Windows Autopilot - WNS Dependencies"; ID = "169"; H = "c.s-microsoft.com" },
    @{ S = "Windows Autopilot - Third-party deployment dependencies"; ID = "173"; H = "ekop.intel.com" },
    @{ S = "Windows Autopilot - Third-party deployment dependencies"; ID = "173"; H = "ekcert.spserv.microsoft.com" },
    @{ S = "Windows Autopilot - Third-party deployment dependencies"; ID = "173"; H = "ftpm.amd.com" },
    @{ S = "Windows Autopilot - Diagnostics upload"; ID = "182"; H = "lgmsapeweu.blob.core.windows.net" },
    @{ S = "Windows Autopilot - Diagnostics upload"; ID = "182"; H = "lgmsapewus2.blob.core.windows.net" },
    @{ S = "Windows Autopilot - Diagnostics upload"; ID = "182"; H = "lgmsapesea.blob.core.windows.net" },
    @{ S = "Windows Autopilot - Diagnostics upload"; ID = "182"; H = "lgmsapeaus.blob.core.windows.net" },
    @{ S = "Windows Autopilot - Diagnostics upload"; ID = "182"; H = "lgmsapeind.blob.core.windows.net" },
    # Defender
    @{ S = "Defender For Endpoint"; ID = "163"; H = "dm.microsoft.com" },
    # EPM
    @{ S = "EPM"; ID = "163"; H = "dm.microsoft.com" },
    @{ S = "EPM"; ID = "181"; H = "events.data.microsoft.com" },
    # Store
    @{ S = "Microsoft Store API"; ID = "None"; H = "displaycatalog.mp.microsoft.com" },
    @{ S = "Microsoft Store API"; ID = "None"; H = "purchase.md.mp.microsoft.com" },
    @{ S = "Microsoft Store API"; ID = "None"; H = "licensing.mp.microsoft.com" },
    @{ S = "Microsoft Store API"; ID = "None"; H = "storeedgefd.dsx.mp.microsoft.com" },
    # Attestation
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape1.eus.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape2.eus2.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape3.cus.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape4.wus.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape5.scus.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "North America"; H = "intunemaape6.ncus.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape7.neu.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape8.neu.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape9.neu.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape10.weu.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape11.weu.attest.azure.net" },
    @{ S = "Microsoft Azure attestation"; ID = "Europe"; H = "intunemaape12.weu.attest.azure.net" },
    # MacOS
    @{ S = "MacOS"; ID = "North America"; H = "macsidecar.manage.microsoft.com" },
    @{ S = "MacOS"; ID = "North America"; H = "macsidecarprod.azureedge.net" },
    @{ S = "MacOS"; ID = "Europe"; H = "macsidecareu.manage.microsoft.com" },
    @{ S = "MacOS"; ID = "Europe"; H = "macsidecarprodeu.azureedge.net" },
    # Powershell
    @{ S = "Powershell"; ID = "North America"; H = "imeswda-afd-primary.manage.microsoft.com" },
    @{ S = "Powershell"; ID = "North America"; H = "imeswda-afd-secondary.manage.microsoft.com" },
    @{ S = "Powershell"; ID = "North America"; H = "imeswda-afd-hotfix.manage.microsoft.com" },
    @{ S = "Powershell"; ID = "Europe"; H = "imeswdb-afd-primary.manage.microsoft.com" },
    @{ S = "Powershell"; ID = "Europe"; H = "imeswdb-afd-secondary.manage.microsoft.com" },
    @{ S = "Powershell"; ID = "Europe"; H = "imeswdb-afd-hotfix.manage.microsoft.com" }
)

Write-Host "Checking connections in Parallel... (Fast mode)" -ForegroundColor Cyan

# Use Parallel ForEach for 50x speed increase
$Failures = $List | ForEach-Object -Parallel {
    $HostName = $_.H -replace "https://", "" # Clean formatting
    
    # Test connection silently
    $Test = Test-NetConnection -ComputerName $HostName -Port 443 -InformationLevel Quiet
    
    if ($Test -eq $false) {
        [PSCustomObject]@{
            Service  = $_.S
            ID       = $_.ID
            Endpoint = $_.H
            Status   = "FAILED"
        }
    }
} -ThrottleLimit 50 # Process 50 endpoints at once

if ($Failures) {
    Write-Host "`nERRORS DETECTED:" -ForegroundColor Red
    $Failures | Format-Table -AutoSize
} else {
    Write-Host "`nSUCCESS: All endpoints reached." -ForegroundColor Green
}
